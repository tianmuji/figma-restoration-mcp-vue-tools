<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>组件还原度对比系统测试</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f9fafb;
            color: #1f2937;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 10px;
        }
        
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .test-section h2 {
            font-size: 20px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 15px;
        }
        
        .test-button {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background 0.2s;
        }
        
        .test-button:hover {
            background: #2563eb;
        }
        
        .test-button.secondary {
            background: #6b7280;
        }
        
        .test-button.secondary:hover {
            background: #4b5563;
        }
        
        .result-area {
            margin-top: 20px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            min-height: 100px;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
        }
        
        .status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status.success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status.warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .component-card {
            padding: 20px;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .component-card h3 {
            margin-bottom: 10px;
            color: #1f2937;
        }
        
        .component-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 14px;
        }
        
        .loading {
            color: #6b7280;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 组件还原度对比系统测试</h1>
            <p>测试数据服务和组件功能</p>
        </div>

        <div class="test-section">
            <h2>📊 数据服务测试</h2>
            <button class="test-button" onclick="testComponentsSummary()">测试组件汇总</button>
            <button class="test-button" onclick="testSystemStats()">测试系统统计</button>
            <button class="test-button" onclick="testDesignV1Report()">测试 DesignV1 报告</button>
            <!-- HelloWorld 测试按钮已移除 -->
            <button class="test-button secondary" onclick="clearResults()">清除结果</button>
            <div id="dataResults" class="result-area">点击按钮开始测试...</div>
        </div>

        <div class="test-section">
            <h2>🖼️ 图片资源测试</h2>
            <button class="test-button" onclick="testImageAccess()">测试图片访问</button>
            <button class="test-button" onclick="testReportFiles()">测试报告文件</button>
            <div id="imageResults" class="result-area">点击按钮开始测试...</div>
        </div>

        <div class="test-section">
            <h2>📋 组件列表预览</h2>
            <button class="test-button" onclick="loadComponentsPreview()">加载组件预览</button>
            <div id="componentsPreview" class="component-grid">
                <div class="loading">点击按钮加载组件数据...</div>
            </div>
        </div>
    </div>

    <script type="module">
        // 导入数据服务
        import { ComparisonDataService } from './services/comparison-data-service.js';
        
        const dataService = new ComparisonDataService();
        
        // 全局函数
        window.testComponentsSummary = async function() {
            const resultArea = document.getElementById('dataResults');
            resultArea.textContent = '正在加载组件汇总数据...';
            
            try {
                const summary = await dataService.getComponentsSummary();
                resultArea.textContent = `✅ 组件汇总加载成功！\n\n${JSON.stringify(summary, null, 2)}`;
            } catch (error) {
                resultArea.textContent = `❌ 加载失败: ${error.message}`;
            }
        };
        
        window.testSystemStats = async function() {
            const resultArea = document.getElementById('dataResults');
            resultArea.textContent = '正在加载系统统计数据...';
            
            try {
                const stats = await dataService.getSystemStats();
                resultArea.textContent = `✅ 系统统计加载成功！\n\n${JSON.stringify(stats, null, 2)}`;
            } catch (error) {
                resultArea.textContent = `❌ 加载失败: ${error.message}`;
            }
        };
        
        window.testDesignV1Report = async function() {
            const resultArea = document.getElementById('dataResults');
            resultArea.textContent = '正在加载 DesignV1 报告...';
            
            try {
                const report = await dataService.getComparisonReport('DesignV1');
                resultArea.textContent = `✅ DesignV1 报告加载成功！\n\n组件: ${report.componentName}\n还原度: ${report.summary.matchPercentage.toFixed(2)}%\n状态: ${report.summary.status}\n问题数: ${report.summary.totalIssues}\n\n完整数据:\n${JSON.stringify(report, null, 2)}`;
            } catch (error) {
                resultArea.textContent = `❌ 加载失败: ${error.message}`;
            }
        };
        
        // HelloWorld 测试已移除
        
        window.testImageAccess = async function() {
            const resultArea = document.getElementById('imageResults');
            resultArea.textContent = '正在测试图片访问...';
            
            const imagePaths = [
                '/src/components/DesignV1/results/expected.png',
                '/src/components/DesignV1/results/actual.png',
                '/src/components/DesignV1/results/diff.png',
                '/src/components/DesignV1/results/heatmap.png'
            ];
            
            let results = '图片访问测试结果:\n\n';
            
            for (const path of imagePaths) {
                try {
                    const response = await fetch(path);
                    if (response.ok) {
                        results += `✅ ${path} - 可访问 (${response.status})\n`;
                    } else {
                        results += `❌ ${path} - 无法访问 (${response.status})\n`;
                    }
                } catch (error) {
                    results += `❌ ${path} - 访问错误: ${error.message}\n`;
                }
            }
            
            resultArea.textContent = results;
        };
        
        window.testReportFiles = async function() {
            const resultArea = document.getElementById('imageResults');
            resultArea.textContent = '正在测试报告文件访问...';
            
            const reportPaths = [
                '/src/components/DesignV1/results/comparison-report.json'
            ];
            
            let results = '报告文件访问测试结果:\n\n';
            
            for (const path of reportPaths) {
                try {
                    const response = await fetch(path);
                    if (response.ok) {
                        const data = await response.json();
                        results += `✅ ${path} - 可访问，组件: ${data.componentName}, 还原度: ${data.summary?.matchPercentage?.toFixed(2) || 'N/A'}%\n`;
                    } else {
                        results += `❌ ${path} - 无法访问 (${response.status})\n`;
                    }
                } catch (error) {
                    results += `❌ ${path} - 访问错误: ${error.message}\n`;
                }
            }
            
            resultArea.textContent = results;
        };
        
        window.loadComponentsPreview = async function() {
            const previewArea = document.getElementById('componentsPreview');
            previewArea.innerHTML = '<div class="loading">正在加载组件数据...</div>';
            
            try {
                const components = await dataService.getComponentsSummary();
                
                previewArea.innerHTML = '';
                
                components.forEach(component => {
                    const card = document.createElement('div');
                    card.className = 'component-card';
                    
                    const statusClass = getStatusClass(component.matchPercentage);
                    
                    card.innerHTML = `
                        <h3>${component.componentName}</h3>
                        <div class="component-info">
                            <div>还原度: <strong>${component.matchPercentage.toFixed(1)}%</strong></div>
                            <div>状态: <span class="status ${statusClass}">${getStatusText(component.status)}</span></div>
                            <div>问题数: ${component.issueCount}</div>
                            <div>最后更新: ${new Date(component.lastUpdated).toLocaleString('zh-CN')}</div>
                            <div style="margin-top: 10px; font-size: 12px; color: #6b7280;">${component.description}</div>
                        </div>
                    `;
                    
                    previewArea.appendChild(card);
                });
                
            } catch (error) {
                previewArea.innerHTML = `<div style="color: #ef4444;">加载失败: ${error.message}</div>`;
            }
        };
        
        window.clearResults = function() {
            document.getElementById('dataResults').textContent = '结果已清除';
            document.getElementById('imageResults').textContent = '结果已清除';
        };
        
        function getStatusClass(percentage) {
            if (percentage >= 95) return 'success';
            if (percentage >= 80) return 'warning';
            return 'error';
        }
        
        function getStatusText(status) {
            const statusMap = {
                excellent: '优秀',
                good: '良好',
                needs_improvement: '需改进',
                poor: '较差',
                unknown: '未知',
                error: '错误'
            };
            return statusMap[status] || status;
        }
        
        // 页面加载完成后自动运行基本测试
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎯 组件还原度对比系统测试页面已加载');
            
            // 自动加载组件预览
            setTimeout(() => {
                loadComponentsPreview();
            }, 1000);
        });
    </script>
</body>
</html>